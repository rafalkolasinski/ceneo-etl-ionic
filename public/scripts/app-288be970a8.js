!function e(n,r,t){function i(s,a){if(!r[s]){if(!n[s]){var c="function"==typeof require&&require;if(!a&&c)return c(s,!0);if(o)return o(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var u=r[s]={exports:{}};n[s][0].call(u.exports,function(e){var r=n[s][1][e];return i(r?r:e)},u,u.exports,e,n,r,t)}return r[s].exports}for(var o="function"==typeof require&&require,s=0;s<t.length;s++)i(t[s]);return i}({1:[function(e,n,r){"use strict";angular.module("CeneoETL",["ionic","ngCordova","ngResource","lokijs"]).run(["$ionicPlatform",function(e){e.ready(function(){})}]).config(["$httpProvider","$stateProvider","$urlRouterProvider",function(e,n,r){n.state("app",{url:"/app","abstract":!0,templateUrl:"templates/main.html",controller:"MainController"}).state("app.etl",{url:"/etl",cache:!0,views:{"tab-etl":{templateUrl:"templates/views/etl.html",controller:"EtlController"}}}).state("reviews",{url:"/reviews",templateUrl:"templates/views/reviews.html",controller:"ReviewsController",params:{productId:""}}),r.otherwise("/app/etl")}]).controller("MainController",e("./controllers/mainController")).controller("EtlController",e("./controllers/etlController")).controller("ReviewsController",e("./controllers/reviewsController")).factory("HTTPService",e("./services/HTTPService")).factory("EtlService",e("./services/EtlService")).factory("DBService",e("./services/DBService")).factory("ProductFactory",e("./services/ProductFactory")).factory("ReviewFactory",e("./services/ReviewFactory")).factory("CSVService",e("./services/CSVService"))},{"./controllers/etlController":2,"./controllers/mainController":3,"./controllers/reviewsController":4,"./services/CSVService":5,"./services/DBService":6,"./services/EtlService":7,"./services/HTTPService":8,"./services/ProductFactory":9,"./services/ReviewFactory":10}],2:[function(e,n,r){"use strict";n.exports=["$scope","$sce","$state","$ionicPlatform","EtlService","DBService","CSVService",function(e,n,r,t,i,o,s){function a(){e.search={productId:""}}function c(){e.numberOfRequestsMade=0,e.numberOfReviewsAddedToDatabase=0,e.productExistsInDatabase=!1,e.etlInProgress=!1,e.hasExtractFinished=!1,e.hasTransformFinished=!1,e.hasLoadingFinished=!1}function l(){c(),a(),e.$on("$stateChangeSuccess",function(){c(),a()}),t.ready(function(){o.initDB()})}e.isProductNumberValid=function(){return e.search.productId.length<8||"string"!=typeof e.search.productId||isNaN(e.search.productId)},e.extract=function(){c();var n=e.search.productId;return e.etlInProgress=!0,i.extractData(n).then(function(n){e.hasExtractFinished=!0,e.hasTransformFinished=!1,e.hasLoadingFinished=!1,e.etlInProgress=!1,e.numberOfRequestsMade=n})},e.transform=function(){return e.etlInProgress=!0,i.transformData().then(function(n){e.hasTransformFinished=!0,e.productExistsInDatabase=n,e.etlInProgress=!1})},e.load=function(){return e.etlInProgress=!0,i.loadData().then(function(n){e.hasTransformFinished=!1,e.hasExtractFinished=!1,e.hasLoadingFinished=!0,e.etlInProgress=!1,e.numberOfReviewsAddedToDatabase=n})},e.etl=function(){var n=e.search.productId;return e.extract(n).then(function(){e.transform().then(function(){e.load()})})},e.clearReviews=function(){return c(),o.removeReviewsFromProduct(e.search.productId)},e.saveToCSV=function(){return s.saveProductReviewsToCSV(e.search.productId)},e.viewReviews=function(){return r.go("reviews",{productId:e.search.productId})},l()}]},{}],3:[function(e,n,r){"use strict";n.exports=["$scope",function(e){}]},{}],4:[function(e,n,r){"use strict";n.exports=["$scope","$stateParams","$state","$ionicHistory","DBService","CSVService",function(e,n,r,t,i,o){function s(){return c?void i.getProductWithId(c).then(function(n){u=!0,l=n,e.productDetails={brand:l.brand,model:l.model,id:l.id}}):r.go("app.etl",{})}function a(e){for(var n in l.reviews)if(l.reviews[n].id===e)return l.reviews[n];return{}}e.productDetails={},e.noMoreItems=!1,e.reviews=[];var c=n.productId,l=[],u=!1;e.goBack=function(){t.goBack()},e.loadMoreItems=function(){if(!c)return void e.$broadcast("scroll.infiniteScrollComplete");var n=e.reviews.length,r=l.reviews.length;e.reviews.push(l.reviews[n]),n===r-1&&(e.noMoreItems=!0),e.$broadcast("scroll.infiniteScrollComplete")},e.$on("$stateChangeSuccess",function(){u&&c&&e.loadMoreItems()}),e.$on("$ionicView.beforeEnter",function(e,n){n.enableBack=!0}),e.saveReview=function(e){var n=a(e);return o.saveSingleReviewToTXT(n,c)},e.getNumber=function(e){return new Array(parseInt(e))},e.hasHalfStar=function(e){var n,r=parseFloat(e.replace(",","."));return n=r>=1?r%parseInt(r):r,n>0},s()}]},{}],5:[function(e,n,r){"use strict";var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};n.exports=["DBService",function(e){function n(n){return e.getProductWithId(n).then(function(e){var r=e.reviews,t=JSON.stringify(r),o=new RegExp(";","g"),s=t.replace(/\\n/g,"").replace(/\[\]/g,'"---"').replace(o,""),a=i(s);a="ADVANTAGES; DISADVANTAGES; SUMMARY; STARS COUNT; AUTHOR; SUBMISSION DATE; RECOMMENDS PRODUCT; RATED USEFUL COUNT; RATED USELESS COUNT; ID; \n"+a;var c=new Blob([a],{type:"text/csv;charset=utf-8"}),l="ProductReviews_"+n+".csv";saveAs(c,l)})}function r(e,n){for(var r="",t=0;t<=9;t++){var i=Object.getOwnPropertyNames(e)[t],o=e[Object.keys(e)[t]];r=r+i+": "+o+"\r\n\r\n"}var s=e.id,a=new Blob([r],{type:"text/plain;charset=utf-8"}),c="Review_nr_"+s+"_from_product_nr_"+n+".txt";saveAs(a,c)}function i(e){console.log(e);for(var n="object"!==("undefined"==typeof e?"undefined":t(e))?JSON.parse(e):e,r="",i=0;i<n.length;i++){var o="";for(var s in n[i])""!==o&&(o+=";"),o+=n[i][s];r+=o+"\r\n"}return r}return{saveProductReviewsToCSV:n,saveSingleReviewToTXT:r}}]},{}],6:[function(e,n,r){"use strict";n.exports=["Loki","$q",function(e,n){function r(){var n=new LokiIndexedAdapter,r="ceneoEtlDB",t={adapter:n,autoload:!0,autosave:!0,autosaveInterval:1e3};d=new e(r,t),v=d.getCollection("products"),v||(v=d.addCollection("products",{indices:["id"]}))}function t(){return n(function(e,n){var r={};d.loadDatabase(r,function(){v=d.getCollection("products"),e(v.data)})})}function i(e){v.insert(e)}function o(e){v.update(e)}function s(e){v.remove(e)}function a(e){return c(e).then(function(e){return void 0!==e})}function c(e){return t().then(function(){return v.find({id:e})[0]})}function l(e,n){return c(e).then(function(e){e.reviews=[].concat(e.reviews,n),o(e)})}function u(e){return c(e).then(function(e){e.reviews=[],o(e)})}var d,v;return{initDB:r,getAllProducts:t,addProduct:i,updateProduct:o,deleteProduct:s,isProductInDB:a,getProductWithId:c,updateReviews:l,removeReviewsFromProduct:u}}]},{}],7:[function(e,n,r){"use strict";n.exports=["$q","HTTPService","ProductFactory","ReviewFactory","DBService",function(e,n,r,t,i){function o(){v=[],p={},f=[],m=!1}function s(e){for(var n=new DOMParser,r=n.parseFromString(e,"text/html"),t=r.getElementsByTagName("link"),i=!1,o=0;o<t.length;o++)if(t[o].hasAttribute("rel")&&"next"===t[o].rel){i=!0,console.log("break",o);break}return i}function a(r,t,i){var o=e.defer();return n.makeRequest(r,t,null).then(function(e){d=r,v.push(e.data),s(e.data)?(t++,a(r,t,i)):(i(t+1),o.resolve())},function(e){console.log("error")}),o.promise}function c(n,r){var t=e.defer(),o={};return i.isProductInDB(r).then(function(e){if(e)m=!0,i.getProductWithId(r).then(function(e){o=e,t.resolve({product:o,fromDB:!0})});else{var s=r;y(n,s).then(function(e){o=e,t.resolve({product:o,fromDB:!1})})}}),t.promise}function l(e){var n=new t,r=e.querySelectorAll(".pros-cell ul li");if(r.length>0)for(var i=0;i<r.length;i++)n.advantages.push(r[i].innerHTML);r=[];var o=e.querySelectorAll(".cons-cell ul li");if(o.length>0)for(var i=0;i<o.length;i++)n.disadvantages.push(o[i].innerHTML);return o=[],n.summary=e.querySelector(".product-review-body").innerHTML,n.starsCount=e.querySelector(".review-score-count").innerHTML,n.starsCount&&(n.starsCount=n.starsCount.replace(/\/\d*/,"")),n.author=e.querySelector(".product-reviewer").innerHTML,n.submissionDate=e.querySelector("time").getAttribute("datetime"),n.recommendsProduct=e.querySelector(".product-review-summary"),n.recommendsProduct&&(n.recommendsProduct=n.recommendsProduct.querySelector("em").innerHTML),n.ratedUsefulCount=e.querySelector(".vote-yes").getAttribute("data-vote"),n.ratedUselessCount=e.querySelector(".vote-no").getAttribute("data-vote"),n.id=new Date(n.submissionDate).getTime(),n}function u(){var n=e.defer();return m?i.updateReviews(p.id,f).then(function(){n.resolve(!0)}):(p.reviews=f,i.addProduct(p),n.resolve(!0)),n.promise}var d,v=[],p={},f=[],m=!1,h=function(n){o();var r=e.defer();return a(n,0,function(e){r.resolve(e)}),r.promise},g=function(){return b(v,d).then(function(e){return e})},w=function(){return u().then(function(){var e=f.length;return f=[],p={},m=!1,e})},b=function(n,r){var t=e.defer(),i=n[0],o=new DOMParser,s=o.parseFromString(i,"text/html"),a=[],l=!1;return c(s,r).then(function(r){p=r.product,l=r.fromDB;for(var i=0;i<n.length;i++)s=o.parseFromString(n[i],"text/html"),a.push(S(s).then(function(e){f=[].concat(f,e)}));e.all(a).then(function(){t.resolve(l)})}),t.promise},y=function(n,t){var i=e.defer(),o=new r.Product;o.id=t,o.category=angular.element(n.querySelector(".breadcrumbs"))[0].querySelectorAll(".breadcrumb")[1].querySelector("span").innerHTML;var s=angular.element(n.querySelector("head"))[0].querySelectorAll("meta");if(s)for(var a=0;a<s.length;a++)s[a].hasAttribute("property")&&"og:brand"===s[a].getAttribute("property")&&(o.brand=s[a].getAttribute("content"));o.model=angular.element(n.querySelector(".js_searchInGoogleTooltip"))[0].innerHTML.replace(/product.brand /gi,"");var c=new RegExp(o.brand+" ","ig");return o.model=o.model.replace(c,""),i.resolve(o),i.promise},S=function(n){for(var t=e.defer(),i=angular.element(n.querySelector(".product-reviews")),o=i[0].querySelectorAll("li.product-review"),s=[],a=0,c=0;c<o.length;c++){var u=new Date(o[c].querySelector("time").getAttribute("datetime")).getTime();if(!r.hasReview(p,u)){var d=l(o[c]);s.push(d),a++}}return t.resolve(s),t.promise};return{extractData:h,transformData:g,loadData:w}}]},{}],8:[function(e,n,r){"use strict";var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};n.exports=["$http",function(e){var n=function(n,r,i){var o="",s="http://www.ceneo.pl/",a=[window.location.origin,window.location.pathname,"proxy?url="].join("");return console.log("undefined"==typeof n?"undefined":t(n)),o=[a,s,n,"/opinie-"+r+";0160-1"].join(""),e({method:"GET",url:o}).success(function(e){return console.log("Successfully got ETL server data.",e.status),e}).error(function(e){return console.log("An error occurred while getting ETL server data.",e),null})};return{makeRequest:n}}]},{}],9:[function(e,n,r){"use strict";n.exports=[function(){function e(e){return angular.copy(r)}function n(e,n){return e.reviews.some(function(e){return e.id===n})}var r={id:"",category:"",brand:"",model:"",additionalFeatures:[],reviews:[]};return{Product:e,hasReview:n}}]},{}],10:[function(e,n,r){"use strict";n.exports=[function(){function e(){return angular.copy(n)}var n={disadvantages:[],advantages:[],summary:"",starsCount:0,author:"",submissionDate:null,recommendsProduct:!1,ratedUsefulCount:0,ratedUselessCount:0,id:""};return e}]},{}]},{},[1]),angular.module("CeneoETL").constant("API_ENDPOINT",{host:"http://localhost",port:3e3,path:"",needsAuth:!1}),angular.module("CeneoETL").run(["$templateCache",function(e){e.put("templates/main.html",'<ion-tabs class="tabs-icon-top">\r\n\r\n  <!-- home tab -->\r\n  <ion-tab title="ETL" icon="icon ion-arrow-swap" href="#/app/etl">\r\n    <ion-nav-view name="tab-etl"></ion-nav-view>\r\n  </ion-tab>\r\n\r\n\r\n</ion-tabs>\r\n'),e.put("templates/views/etl.html",'<ion-view title="ETL">\r\n  <ion-content class="has-header">\r\n    <div class="main-wrapper">\r\n\r\n      <!-- info card -->\r\n      <div class="card card-info">\r\n        <div class="item item-text-wrap center-text card-background">\r\n          <span class="card-text">Poniżej wpisz ID produktu, dla którego chcesz pobrać opinie</span>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- product name input -->\r\n      <div class="list list-inset">\r\n        <label class="item item-input product-name-input-label">\r\n          <i class="icon ion-search placeholder-icon"></i>\r\n          <input type="text" placeholder="Szukaj..." ng-model="search.productId">\r\n        </label>\r\n      </div>\r\n\r\n      <!-- etl buttons -->\r\n      <div class="etl-buttons">\r\n        <div class="button-bar">\r\n          <button class="button" ng-click="extract()" ng-disabled="isProductNumberValid() || etlInProgress">\r\n            <span>EXTRACT</span>\r\n          </button>\r\n          <button class="button" ng-click="transform()" ng-disabled="!hasExtractFinished || hasTransformFinished">\r\n            <span>TRANSFORM</span>\r\n          </button>\r\n          <button class="button" ng-click="load()" ng-disabled="!hasTransformFinished">\r\n            <span>LOAD</span>\r\n          </button>\r\n        </div>\r\n\r\n        <button class="button button-full" ng-click="etl()" ng-disabled="isProductNumberValid() || hasTransformFinished || etlInProgress">\r\n          <span>ETL</span>\r\n        </button>\r\n        <div class="spinner-container">\r\n          <span>\r\n             <ion-spinner icon="lines" ng-if="etlInProgress"></ion-spinner>\r\n          </span>\r\n        </div>\r\n      </div>\r\n      <ion-list class="etl-progress">\r\n        <ion-item class="item etl-progress-item" ng-show="hasExtractFinished || hasLoadingFinished">\r\n          <span>Liczba wykonanych requestów: </span>\r\n          <span>{{ numberOfRequestsMade }}</span>\r\n        </ion-item>\r\n        <ion-item class="item etl-progress-item" ng-show="hasTransformFinished || hasLoadingFinished">\r\n          <span>Produkt już był w bazie: </span>\r\n          <span>{{ productExistsInDatabase  ? \'TAK\' : \'NIE\'}}</span>\r\n        </ion-item>\r\n        <ion-item class="item etl-progress-item" ng-show="hasLoadingFinished && productExistsInDatabase">\r\n          <span>Liczba nowych opinii dodanych do istniejącego produktu: </span>\r\n          <span>{{ numberOfReviewsAddedToDatabase }}</span>\r\n        </ion-item>\r\n        <ion-item class="item etl-progress-item" ng-show="hasLoadingFinished && !productExistsInDatabase">\r\n          <span>Nowy produkt dodany do bazy z następującą liczbą opinii: </span>\r\n          <span>{{ numberOfReviewsAddedToDatabase }}</span>\r\n        </ion-item>\r\n      </ion-list>\r\n\r\n      <div class="action-buttons">\r\n        <button class="button button-centered button-full" ng-click="clearReviews()" ng-disabled="!hasLoadingFinished">\r\n          <span>Wyczyść wszystkie opinie dla tego produktu</span>\r\n        </button>\r\n\r\n        <button class="button button-centered button-full" ng-click="saveToCSV()" ng-disabled="!hasLoadingFinished" >\r\n          <span>Zapisz wszystkie opinie o produkcie do pliku CSV</span>\r\n        </button>\r\n\r\n        <button class="button button-centered button-full" ng-click="viewReviews()" ng-disabled="!hasLoadingFinished">\r\n          <span>Pokaż opinie</span>\r\n        </button>\r\n      </div>\r\n\r\n\r\n\r\n    </div>\r\n  </ion-content>\r\n</ion-view>\r\n'),e.put("templates/views/reviews.html",'<ion-view title="Opinie">\r\n\r\n\r\n  <ion-content class="has-header padding">\r\n\r\n    <!-- product info card-->\r\n    <div class="card card-info">\r\n      <div class="item item-text-wrap center-text card-background">\r\n        <div class="card-text">\r\n          <span>{{productDetails.brand}}&nbsp;{{productDetails.model}}</span><br /><br />\r\n          <span>ID: {{productDetails.id}}</span>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <ion-list>\r\n      <ion-item class="review-container card-background" ng-repeat="review in reviews track by review.id">\r\n\r\n        <div class="item item-divider card-background-header review-item">\r\n          <div class="card-text list-icon">\r\n            <i class="icon ion-person"></i>\r\n          </div>\r\n          <div class="card-text">{{review.author}}</div>\r\n        </div>\r\n\r\n        <div class="item review-item">\r\n          <div class="list-icon">\r\n            <i class="icon ion-calendar"></i>\r\n          </div>\r\n          <div>{{review.submissionDate}}</div>\r\n        </div>\r\n\r\n        <div class="item review-item inner-items-space-between" ng-if="review.recommendsProduct">\r\n          <div class="review-item">\r\n            <div class="list-icon" ng-show="review.recommendsProduct === \'Polecam\'">\r\n              <i class="icon ion-checkmark color-green"></i>\r\n            </div>\r\n            <div class="list-icon" ng-show="review.recommendsProduct === \'Nie polecam\'">\r\n              <i class="icon ion-close color-red"></i>\r\n            </div>\r\n            <div>{{review.recommendsProduct}}</div>\r\n          </div>\r\n          <div class="review-item">\r\n            <div class="list-icon">\r\n              <i class="icon ion-star" ng-repeat="i in getNumber(review.starsCount) track by $index"></i>\r\n              <i class="ion-ios-star-half" ng-if="hasHalfStar(review.starsCount)"></i>\r\n            </div>\r\n            <div>{{review.starsCount}}</div>\r\n          </div>\r\n        </div>\r\n\r\n\r\n\r\n        <div class="item review-item wrap-normal">\r\n          <div class="list-icon">\r\n            <i class="icon ion-chatbubble-working"></i>\r\n          </div>\r\n          <div class="text-justify">{{review.summary}}</div>\r\n        </div>\r\n\r\n\r\n        <div class="item review-item" ng-if="review.advantages.length > 0">\r\n          <div class="list-icon">\r\n            <i class="icon ion-arrow-graph-up-right"></i>\r\n          </div>\r\n          <ul class="wrap-normal">\r\n            <li ng-repeat="advantage in ::review.advantages">{{advantage}}</li>\r\n          </ul>\r\n        </div>\r\n\r\n        <div class="item review-item" ng-if="review.disadvantages.length > 0">\r\n          <div class="list-icon">\r\n            <i class="icon ion-arrow-graph-down-right"></i>\r\n          </div>\r\n          <ul class="wrap-normal">\r\n            <li ng-repeat="disadvantage in ::review.disadvantages">{{disadvantage}}</li>\r\n          </ul>\r\n        </div>\r\n\r\n        <div class="item review-item inner-items-space-around">\r\n          <div class="review-item">\r\n            <div class="list-icon">\r\n              <i class="icon ion-thumbsup color-green"></i>\r\n            </div>\r\n            <div class="color-green">{{review.ratedUsefulCount}}</div>\r\n          </div>\r\n          <div class="review-item">\r\n            <div class="list-icon">\r\n              <i class="icon ion-thumbsdown color-red"></i>\r\n            </div>\r\n            <div class="color-red">{{review.ratedUselessCount}}</div>\r\n          </div>\r\n\r\n        </div>\r\n\r\n        <button class="button button-full margin-none" ng-click="saveReview(review.id)">\r\n          <span>Zapisz tę opinię o produkcie do pliku tekstowego</span>\r\n        </button>\r\n      </ion-item>\r\n    </ion-list>\r\n\r\n    <ion-infinite-scroll ng-if="!noMoreItems" on-infinite="loadMoreItems()" distance="5%" icon="ion-loading-c"></ion-infinite-scroll>\r\n\r\n  </ion-content>\r\n</ion-view>\r\n')}]);