!function e(t,r,n){function o(a,s){if(!r[a]){if(!t[a]){var c="function"==typeof require&&require;if(!s&&c)return c(a,!0);if(i)return i(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var l=r[a]={exports:{}};t[a][0].call(l.exports,function(e){var r=t[a][1][e];return o(r?r:e)},l,l.exports,e,t,r,n)}return r[a].exports}for(var i="function"==typeof require&&require,a=0;a<n.length;a++)o(n[a]);return o}({1:[function(e,t,r){"use strict";angular.module("CeneoETL",["ionic","ngCordova","ngResource","pouchdb","lokijs"]).run(["$ionicPlatform",function(e){e.ready(function(){})}]).config(["$httpProvider","$stateProvider","$urlRouterProvider",function(e,t,r){t.state("app",{url:"/app","abstract":!0,templateUrl:"templates/main.html",controller:"MainController"}).state("app.etl",{url:"/etl",cache:!0,views:{"tab-etl":{templateUrl:"templates/views/etl.html",controller:"EtlController"}}}).state("app.stats",{url:"/stats",views:{"tab-stats":{templateUrl:"templates/views/stats.html",controller:"StatsController"}}}),r.otherwise("/app/etl")}]).controller("MainController",e("./controllers/mainController")).controller("EtlController",e("./controllers/etlController")).controller("StatsController",e("./controllers/statsController")).factory("HTTPService",e("./services/HTTPService")).factory("EtlService",e("./services/EtlService")).factory("DBService",e("./services/DBService")).factory("UtilService",e("./services/UtilService")).factory("ProductFactory",e("./services/ProductFactory")).factory("ReviewFactory",e("./services/ReviewFactory"))},{"./controllers/etlController":2,"./controllers/mainController":3,"./controllers/statsController":4,"./services/DBService":5,"./services/EtlService":6,"./services/HTTPService":7,"./services/ProductFactory":8,"./services/ReviewFactory":9,"./services/UtilService":10}],2:[function(e,t,r){"use strict";t.exports=["$scope","$sce","$ionicPlatform","EtlService","DBService",function(e,t,r,n,o){e.hasExtractFinished=!1,e.hasTransformFinished=!1,e.search={searchKeywords:""},r.ready(function(){o.initDB()}),e.isProductNumberValid=function(){return e.search.searchKeywords.length<8||"string"!=typeof e.search.searchKeywords||isNaN(e.search.searchKeywords)},e.extract=function(){var t=e.search.searchKeywords;return n.extractData(t).then(function(){e.hasExtractFinished=!0}),e.data},e.transform=function(){return n.transformData().then(function(){e.hasTransformFinished=!0})},e.load=function(){return n.loadData().then(function(){e.hasTransformFinished=!1,e.hasExtractFinished=!1})},e.etl=function(){var t=e.search.searchKeywords;return n.extractData(t).then(function(){return e.hasExtractFinished=!0,n.transformData().then(function(){e.hasTransformFinished=!0})})}}]},{}],3:[function(e,t,r){"use strict";t.exports=["$scope",function(e){}]},{}],4:[function(e,t,r){"use strict";t.exports=["$scope",function(e){}]},{}],5:[function(e,t,r){"use strict";t.exports=["Loki","$q",function(e,t){function r(){var t=new LokiIndexedAdapter;l=new e("ceneoDB",{autosave:!0,autosaveInterval:1e3,adapter:t}),d||(d=l.addCollection("products",{indices:["id"]})),console.log(d)}function n(){return t(function(e,t){var r={};l.loadDatabase(r,function(){d=l.getCollection("products"),console.log("PRODUCTS IN DB",d.data),e(d.data)})})}function o(e){d.insert(e),console.log("----PRODUCT ADDED TO DATABASE----")}function i(e){d.update(e)}function a(e){d.remove(e)}function s(e){return c(e).then(function(e){return void 0!==e})}function c(e){return n().then(function(){return d.find({id:e})[0]})}function u(e,t){return c(e).then(function(e){e.reviews=[].concat(e.reviews,t),i(e),console.log("PRODUCT UPDATED WITH REVIEWS ",t)})}var l,d;return t.defer(),{initDB:r,getAllProducts:n,addProduct:o,updateProduct:i,deleteProduct:a,isProductInDB:s,getProductWithId:c,updateReviews:u}}]},{}],6:[function(e,t,r){"use strict";t.exports=["$q","HTTPService","ProductFactory","ReviewFactory","DBService",function(e,t,r,n,o){function i(t,r){var n=e.defer(),i={};return o.isProductInDB(r).then(function(e){if(e)f=!0,o.getProductWithId(r).then(function(e){i=e,console.log("PRODUCT ALREADY IN DB ",i),n.resolve(i)});else{var a=r;y(t,a).then(function(e){i=e,console.log("NEW PRODUCT. EXTRACTED FROM FROM HTML ",i),n.resolve(i)})}}),n.promise}function a(e){var t=new n,r=e.querySelectorAll(".pros-cell ul li");if(r.length>0)for(var o=0;o<r.length;o++)t.disadvantages.push(r[o].innerHTML);r=[];var i=e.querySelectorAll(".cons-cell ul li");if(i.length>0)for(var o=0;o<i.length;o++)t.advantages.push(i[o].innerHTML);return i=[],t.summary=e.querySelector(".product-review-body").innerHTML,t.starsCount=e.querySelector(".review-score-count").innerHTML,t.starsCount&&(t.starsCount=t.starsCount.replace(/\/\d*/,"")),t.author=e.querySelector(".product-reviewer").innerHTML,t.submissionDate=e.querySelector("time").getAttribute("datetime"),t.recommendsProduct=e.querySelector(".product-review-summary"),t.recommendsProduct&&(t.recommendsProduct=t.recommendsProduct.querySelector("em").innerHTML),t.ratedUsefulCount=e.querySelector(".vote-yes").getAttribute("data-vote"),t.ratedUselessCount=e.querySelector(".vote-no").getAttribute("data-vote"),t.id=new Date(t.submissionDate).getTime(),t}function s(){var t=e.defer();return f?o.updateReviews(l.id,d).then(function(){t.resolve(!0)}):(l.reviews=d,o.addProduct(l),t.resolve(!0)),t.promise}var c,u,l={},d=[],f=!1,p=function(e){return t.makeRequest(e,0,null).then(function(t){c=t.data,u=e},function(e){console.log("error")})},v=function(){return m(c,u).then(function(e){console.log("TRANSFORMED PRODUCT ",l)})},h=function(){return s().then(function(){d=[],l={},f=!1})},m=function(t,r){var n=e.defer(),o=t,a=new DOMParser,s=a.parseFromString(o,"text/html");return i(s,r).then(function(e){l=e,b(s).then(function(e){d=e,n.resolve(!0)})}),n.promise},y=function(t,n){var o=e.defer(),i=new r.Product;i.id=n,i.category=angular.element(t.querySelector(".breadcrumbs"))[0].querySelectorAll(".breadcrumb")[1].querySelector("span").innerHTML;var a=angular.element(t.querySelector("head"))[0].querySelectorAll("meta");if(a)for(var s=0;s<a.length;s++)a[s].hasAttribute("property")&&"og:brand"===a[s].getAttribute("property")&&(i.brand=a[s].getAttribute("content"));i.model=angular.element(t.querySelector(".js_searchInGoogleTooltip"))[0].innerHTML.replace(/product.brand /gi,"");var c=new RegExp(i.brand+" ","ig");return i.model=i.model.replace(c,""),o.resolve(i),o.promise},b=function(t){for(var n=e.defer(),o=angular.element(t.querySelector(".product-reviews")),i=o[0].querySelectorAll("li.product-review"),s=[],c=0,u=0;u<i.length;u++){var d=new Date(i[u].querySelector("time").getAttribute("datetime")).getTime();if(!r.hasReview(l,d)){var f=a(i[u]);s.push(f),c++}}return console.log("ADDED ",c," NEW REVIEWS TO PRODUCT"),n.resolve(s),n.promise};return{extractData:p,transformData:v,loadData:h}}]},{}],7:[function(e,t,r){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.exports=["$http",function(e){var t=function(t,r,o){var i="",a="http://www.ceneo.pl/",s=[window.location.origin,window.location.pathname,"proxy?url="].join("");return console.log("undefined"==typeof t?"undefined":n(t)),i=[s,a,t,"/opinie-"+r+";0160-1"].join(""),e({method:"GET",url:i}).success(function(e){return console.log("Successfully got ETL server data."),e}).error(function(e){return console.log("An error occured while getting ETL server data.",e),null})};return{makeRequest:t}}]},{}],8:[function(e,t,r){"use strict";t.exports=["DBService",function(e){function t(e){return angular.copy(n)}function r(e,t){return e.reviews.some(function(e){return e.id===t})}var n={id:"",category:"",brand:"",model:"",additionalFeatures:[],reviews:[]};return{Product:t,hasReview:r}}]},{}],9:[function(e,t,r){"use strict";t.exports=[function(){function e(e){return angular.copy(t)}var t={disadvantages:[],advantages:[],summary:"",starsCount:0,author:"",submissionDate:null,recommendsProduct:!1,ratedUsefulCount:0,ratedUselessCount:0,id:""};return e}]},{}],10:[function(e,t,r){"use strict";t.exports=["$http",function(e){}]},{}]},{},[1]),angular.module("CeneoETL").constant("API_ENDPOINT",{host:"http://localhost",port:3e3,path:"",needsAuth:!1}),angular.module("CeneoETL").run(["$templateCache",function(e){e.put("templates/main.html",'<ion-tabs class="tabs-icon-top">\r\n\r\n  <!-- home tab -->\r\n  <ion-tab title="ETL" icon="icon ion-arrow-swap" href="#/app/etl">\r\n    <ion-nav-view name="tab-etl"></ion-nav-view>\r\n  </ion-tab>\r\n\r\n  <!-- stats tab -->\r\n  <ion-tab title="Opinie" icon="icon ion-ios-star-outline" href="#/app/stats">\r\n    <ion-nav-view name="tab-stats"></ion-nav-view>\r\n  </ion-tab>\r\n\r\n</ion-tabs>\r\n'),e.put("templates/views/etl.html",'<ion-view title="Home">\r\n  <ion-content class="has-header">\r\n    <div class="etl-buttons">\r\n\r\n      <!-- info card -->\r\n      <div class="card">\r\n        <div class="item item-text-wrap center-text card-background">\r\n          <span class="card-text">Wprowadź nazwę produktu, którego opinie chciał(a)byś sprawdzić, a następnie użyj przycisku(-ów) ETL, aby rozpocząć proces.</span>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- product name input -->\r\n      <div class="list list-inset">\r\n        <label class="item item-input product-name-input-label">\r\n          <i class="icon ion-search placeholder-icon"></i>\r\n          <input type="text" placeholder="Szukaj..." ng-model="search.searchKeywords">\r\n        </label>\r\n      </div>\r\n\r\n      <!-- etl buttons -->\r\n      <div class="button-bar">\r\n        <button class="button button-full" ng-click="extract()" ng-disabled="isProductNumberValid()">\r\n          <span>Extract</span>\r\n        </button>\r\n        <button class="button button-full" ng-click="transform()" ng-disabled="!hasExtractFinished">\r\n          <span>Transform</span>\r\n        </button>\r\n        <button class="button button-full" ng-click="load()" ng-disabled="!hasTransformFinished">\r\n          <span>Load</span>\r\n        </button>\r\n      </div>\r\n\r\n      <button class="button button-full" ng-click="etl()" ng-disabled="isProductNumberValid()">\r\n        <span>ETL</span>\r\n      </button>\r\n    </div>\r\n  </ion-content>\r\n</ion-view>\r\n'),e.put("templates/views/stats.html",'<ion-view title="Stats">\r\n  <ion-content class="has-header padding">\r\n    <h1>Stats</h1>\r\n  </ion-content>\r\n</ion-view>\r\n')}]);